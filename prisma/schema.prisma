generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-1.0.x"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Account {
  id                String      @id
  usersCount        Int
  usersLimit        Int
  createdAt         String

  users             User[]
  projects          Project[]
}

model Project {
  id                String      @id

  account           Account     @relation(fields: [accountId], references: [id])
  accountId         String

  name              String
  createdAt         String

  features          Feature[]
  tasks             Task[]
}

model User {
  id                String      @id

  account           Account     @relation(fields: [accountId], references: [id])
  accountId         String

  email             String      @unique
  passwordHash      String
  firstName         String
  lastName          String
  role              UserRole
  createdAt         String

  createdTasks      Task[]      @relation("creator")
  tasksToExecute    Task[]      @relation("executive")
  tasksToTest       Task[]      @relation("tester")
  comments          Comment[]
}
enum UserRole {
  Owner
  Worker
}

model Feature {
  id                String      @id
  project           Project     @relation(fields: [projectId], references: [id])
  projectId         String
  name              String
  createdAt         String
  tasks             Task[]
}

model Task {
  id                String      @id

  project           Project     @relation(fields: [projectId], references: [id])
  projectId         String

  feature           Feature?    @relation(fields: [featureId], references: [id])
  featureId         String?

  release           Release?    @relation(fields: [releaseId], references: [id])
  releaseId         String?

  creator           User?       @relation("creator", fields: [creatorId], references: [id])
  creatorId         String?

  executive         User?       @relation("executive", fields: [executiveId], references: [id])
  executiveId       String?

  tester            User?       @relation("tester", fields: [testerId], references: [id])
  testerId          String?

  status            TaskStatus
}
enum TaskStatus {
  Backlog
  Prioritized
  Todo
  InProgress
  Resolved
  Deployed
  InTest
  OnReview
  Done
  Released
}

model Comment {
  id                String      @id
  text              String

  user              User        @relation(fields: [comentatorId], references: [id])
  comentatorId      String
}

model Release {
  id                String      @id
  name              String
  description       String?
  releaseDate       String
  releasedAt        String?

  tasks Task[]
}
