generator client {
  provider = "prisma-client-js"
  previewFeatures = ["interactiveTransactions"]
  binaryTargets = ["native", "rhel-openssl-1.0.x"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Account {
  id                String      @id
  name              String
  email             String      @unique
  usersCount        Int         @default(0)
  usersLimit        Int         @default(5)
  createdAt         DateTime    @default(now())

  users             User[]
  projects          Project[]
}

model Project {
  id                String      @id
  name              String
  createdAt         DateTime    @default(now())

  account           Account     @relation(fields: [accountId], references: [id])
  accountId         String

  features          Feature[]
  tasks             Task[]
}

model User {
  id                String      @id
  email             String      @unique
  passwordHash      String
  firstName         String
  lastName          String
  role              UserRole
  createdAt         DateTime    @default(now())

  account           Account     @relation(fields: [accountId], references: [id])
  accountId         String

  createdTasks      Task[]      @relation("creator")
  tasksToExecute    Task[]      @relation("executive")
  tasksToTest       Task[]      @relation("tester")
  comments          Comment[]
}
enum UserRole {
  owner
  worker
}

model Feature {
  id                String      @id
  name              String
  createdAt         DateTime    @default(now())

  project           Project     @relation(fields: [projectId], references: [id])
  projectId         String

  tasks             Task[]
}

model Task {
  id                String      @id
  title             String
  status            TaskStatus
  updatedAt         DateTime    @default(now())
  createdAt         DateTime    @default(now())

  project           Project     @relation(fields: [projectId], references: [id])
  projectId         String

  feature           Feature?    @relation(fields: [featureId], references: [id])
  featureId         String?

  release           Release?    @relation(fields: [releaseId], references: [id])
  releaseId         String?

  creator           User        @relation("creator", fields: [creatorId], references: [id])
  creatorId         String

  executive         User?       @relation("executive", fields: [executiveId], references: [id])
  executiveId       String?

  tester            User?       @relation("tester", fields: [testerId], references: [id])
  testerId          String?
}
enum TaskStatus {
  Backlog
  Prioritized
  Todo
  InProgress
  Resolved
  Deployed
  InTest
  OnReview
  Done
  Released
}

model Comment {
  id                String      @id
  text              String
  createdAt         DateTime    @default(now())

  user              User        @relation(fields: [comentatorId], references: [id])
  comentatorId      String
}

model Release {
  id                String      @id
  name              String
  description       String?
  releaseDate       DateTime
  releasedAt        DateTime?

  tasks Task[]
}
